// The Site library is used to apply site specific changes
var Site = require('./lib/site');

// The Nugget library provides tools for accessing and managing Nuggets.
var Nugget = require('./lib/nugget');


/**
 * The file Node.js will start with when requiring the ActiveRules module.
 */
module.exports =  function (nextApp) {
  
  return function (req) {
    console.log(req.env.config.ar);
    
    // Load the Site specfic configuration using the req host and the AR config directory
    req.siteConfig = Site.getSiteConfig(req.host, req.env.config.ar.configDir);

    // Pass the request along
    return nextApp(req);
  }    

} 
